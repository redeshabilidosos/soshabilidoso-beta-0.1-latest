<!DOCTYPE html>
<html>
<head>
    <title>Test Cover Photo Upload</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 600px; margin: 0 auto; }
        .result { background: #333; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { background: #00ff88; color: black; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        input { padding: 10px; margin: 10px 0; width: 100%; }
        img { max-width: 200px; border-radius: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Cover Photo Upload</h1>
        
        <div>
            <h3>1. Login</h3>
            <input type="email" id="email" placeholder="Email" value="molo@molo.com">
            <input type="password" id="password" placeholder="Password" value="molo123456">
            <button onclick="login()">Login</button>
        </div>
        
        <div>
            <h3>2. Upload Cover Photo</h3>
            <input type="file" id="coverFile" accept="image/*">
            <button onclick="uploadCover()">Upload Cover</button>
        </div>
        
        <div>
            <h3>3. Results</h3>
            <div id="results"></div>
        </div>
    </div>

    <script>
        let accessToken = '';
        
        function addResult(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            results.appendChild(div);
        }
        
        async function login() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch('http://localhost:8000/api/auth/login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    accessToken = result.access;
                    addResult('‚úÖ Login exitoso');
                    addResult(`Usuario: ${result.user.display_name}`);
                    addResult(`Cover actual: ${result.user.cover_photo || 'No definido'}`);
                } else {
                    addResult('‚ùå Error en login: ' + await response.text());
                }
            } catch (error) {
                addResult('‚ùå Error: ' + error.message);
            }
        }
        
        async function uploadCover() {
            if (!accessToken) {
                addResult('‚ùå Debes hacer login primero');
                return;
            }
            
            const fileInput = document.getElementById('coverFile');
            const file = fileInput.files[0];
            
            if (!file) {
                addResult('‚ùå Selecciona un archivo');
                return;
            }
            
            const formData = new FormData();
            formData.append('cover_photo', file);
            
            try {
                addResult('üì§ Subiendo archivo...');
                
                const response = await fetch('http://localhost:8000/api/auth/upload-cover/', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    },
                    body: formData
                });
                
                addResult(`Status: ${response.status}`);
                
                if (response.ok) {
                    const result = await response.json();
                    addResult('‚úÖ Subida exitosa');
                    addResult(`Mensaje: ${result.message}`);
                    addResult(`URL: ${result.cover_photo_url}`);
                    
                    if (result.user) {
                        addResult(`Cover en usuario: ${result.user.cover_photo}`);
                        addResult(`Cover URL en usuario: ${result.user.cover_photo_url}`);
                        
                        // Mostrar imagen
                        const img = document.createElement('img');
                        img.src = result.cover_photo_url;
                        img.alt = 'Cover photo subida';
                        document.getElementById('results').appendChild(img);
                    }
                } else {
                    addResult('‚ùå Error: ' + await response.text());
                }
            } catch (error) {
                addResult('‚ùå Error: ' + error.message);
            }
        }
    </script>
</body>
</html>